<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>docker | Xyのblog</title><meta name="keywords" content="docker"><meta name="author" content="小羊肖恩"><meta name="copyright" content="小羊肖恩"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="日期：2021&#x2F;3&#x2F;4 内容出处：黑马：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1CJ411T7BK?p&#x3D;1 所学内容：docker安装、docker命令、Docker容器的数据、Dockerfile自定义镜像、Docker-Compose、Docker镜像仓库 遇到的问题： 总结： 今天学习了docker，了解了它的概念，完成了docker的安装，学习了docker的一">
<meta property="og:type" content="article">
<meta property="og:title" content="docker">
<meta property="og:url" content="http://example.com/2022/04/07/docker/index.html">
<meta property="og:site_name" content="Xyのblog">
<meta property="og:description" content="日期：2021&#x2F;3&#x2F;4 内容出处：黑马：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1CJ411T7BK?p&#x3D;1 所学内容：docker安装、docker命令、Docker容器的数据、Dockerfile自定义镜像、Docker-Compose、Docker镜像仓库 遇到的问题： 总结： 今天学习了docker，了解了它的概念，完成了docker的安装，学习了docker的一">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img0.baidu.com/it/u=3264599554,560842961&fm=253&fmt=auto&app=138&f=JPEG?w=1024&h=302">
<meta property="article:published_time" content="2022-04-07T11:39:08.000Z">
<meta property="article:modified_time" content="2022-04-07T11:43:19.587Z">
<meta property="article:author" content="小羊肖恩">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img0.baidu.com/it/u=3264599554,560842961&fm=253&fmt=auto&app=138&f=JPEG?w=1024&h=302"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/04/07/docker/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'docker',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-04-07 19:43:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/constown/HexoCustomFile@0.0.4/dist/css/custom.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fa fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-photo"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user-circle-o"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://img0.baidu.com/it/u=3264599554,560842961&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=302')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Xyのblog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fa fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-photo"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user-circle-o"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">docker</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-04-07T11:39:08.000Z" title="发表于 2022-04-07 19:39:08">2022-04-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-04-07T11:43:19.587Z" title="更新于 2022-04-07 19:43:19">2022-04-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>18分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="docker"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>日期：2021/3/4</p>
<p>内容出处：黑马：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1CJ411T7BK?p=1">https://www.bilibili.com/video/BV1CJ411T7BK?p=1</a></p>
<p>所学内容：docker安装、docker命令、Docker容器的数据、Dockerfile自定义镜像、Docker-Compose、Docker镜像仓库</p>
<p>遇到的问题：</p>
<p>总结：</p>
<p>今天学习了docker，了解了它的概念，完成了docker的安装，学习了docker的一些相关命令并完成了docker镜像和容器的增删查导入导出，后面又学习了docker 的数据卷和应用部署，并通过部外部机器访问了部署的项目。后续又搭建私有仓库，从公共仓库拉取镜像传到私有仓库，反之也可（跟maven私有仓库操作差不多）。</p>
<h1 id="一、docker安装"><a href="#一、docker安装" class="headerlink" title="一、docker安装"></a>一、docker安装</h1><p>安装命令，在CentOS 7 系统下安装（<a target="_blank" rel="noopener" href="https://blog.csdn.net/promsing/article/details/120208826?ops_request_misc=%7B%22request_id%22:%22164767546916782184657122%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=164767546916782184657122&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-120208826.142%5Ev2%5Epc_search_result_control_group,143%5Ev4%5Econtrol&utm_term=centos7%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B&spm=1018.2226.3001.4187">centos7安装教程</a>），需要能联网</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 1、yum 包更新到最新 </span><br><span class="line">yum update</span><br><span class="line"># 2、安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的 </span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"># 3、 设置yum源</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"># 4、 安装docker，出现输入的界面都按 y </span><br><span class="line">yum install -y docker-ce</span><br><span class="line"># 5、 查看docker版本，验证是否验证成功</span><br><span class="line">docker -v</span><br></pre></td></tr></table></figure>

<p>设置容器镜像服务，找到<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">阿里云镜像加速器</a>里的命令，直接复制到centos 7 终端即可</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1646286993058-4da0ff1f-8b08-467a-b1d1-950fb8cfe515.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1646287122456-0989a9d3-bb21-4b94-b3d0-e0fcbc6ffaed.png" alt="img"></p>
<p>可用cat /etc/docker/daemon.json  查看该文件下是否有添加该镜像加速器</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1646287301311-6481e291-e7d6-4bae-b370-563bb16bbad9.png" alt="img"></p>
<h1 id="二、docker命令"><a href="#二、docker命令" class="headerlink" title="二、docker命令"></a>二、docker命令</h1><h2 id="1-进程相关命令"><a href="#1-进程相关命令" class="headerlink" title="1. 进程相关命令"></a>1. 进程相关命令</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1646286880998-742a0a28-28a4-4c29-bfe1-5d5e8d00ffc8.png" alt="img"></p>
<h2 id="2-镜像相关命令"><a href="#2-镜像相关命令" class="headerlink" title="2. 镜像相关命令"></a>2. 镜像相关命令</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1646289098196-01a57c58-dbc2-4b03-956c-ea4d2965e7d9.png" alt="img"></p>
<ul>
<li>使用docker save导出镜像到磁盘 </li>
</ul>
<p>docker save -o [保存的目标文件名称] [镜像名称]</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647913024896-a6a9454a-75e0-4fd3-9d3f-2ffa0beebbb5.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647913066026-500355c1-c764-4922-8edb-92d0a43c5236.png" alt="img"></p>
<p>使用docker load加载镜像</p>
<p>先删除本地的镜像：</p>
<p>docker rmi redis:7.0-rc2</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647913375063-252ae4c2-e8ed-493a-b2cd-57f08c6a9e44.png" alt="img"></p>
<p>然后运行命令，加载本地文件：</p>
<p>docker load -i redis.tar</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647913443677-cf48c301-9488-40aa-b6ff-3ff4ae4f04e4.png" alt="img"></p>
<p>例：去docker hub 搜索redis可用的镜像版本<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1646289267365-30becb2b-804d-4625-ae84-fc79da96b7e7.png" alt="img"></p>
<p>如下为redis支持的tags版本</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1646289398315-ac8d83e5-0452-4ef6-b46e-a5abb52f1bee.png" alt="img"></p>
<h2 id="3-容器相关命令"><a href="#3-容器相关命令" class="headerlink" title="3.  容器相关命令"></a>3.  容器相关命令</h2><p>容器操作的命令如图：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647914033616-5d17c88e-ed5b-4746-97e9-5b04f84de90d.png" alt="img"></p>
<p>容器保护三个状态：</p>
<ul>
<li>运行：进程正常运行</li>
<li>暂停：进程暂停，CPU不再运行，并不释放内存</li>
<li>停止：进程终止，回收进程占用的内存、CPU等资源</li>
</ul>
<p>查看容器日志的命令：</p>
<ul>
<li>docker logs</li>
<li>添加 -f 参数可以持续查看日志</li>
</ul>
<p> <img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1646289675236-ae295a69-93fe-4b48-90ae-22fd3b018ccc.png" alt="img"></p>
<p>例子：</p>
<p>创建并启动容器：docker run -id –name=m1 mysql /bin/bash</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1646294018805-361463a6-d7a0-45ac-848a-952b76cce5a5.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1646289975773-8ed83495-6f54-41fd-9c1f-c1a157f1693d.png" alt="img"></p>
<ul>
<li><p>docker rm 容器名称 -f ： 强制删除运行中的</p>
</li>
<li><p>docker pause：让一个运行的容器暂停</p>
</li>
<li><p>docker unpause：让一个容器从暂停状态恢复运行</p>
</li>
</ul>
<h3 id="案例1-创建并运行一个容器"><a href="#案例1-创建并运行一个容器" class="headerlink" title="案例1-创建并运行一个容器"></a>案例1-创建并运行一个容器</h3><p>创建并运行nginx容器的命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name ng -p 80:80 -d nginx</span><br></pre></td></tr></table></figure>



<p>命令解读：</p>
<ul>
<li>docker run ：创建并运行一个容器</li>
<li>–name : 给容器起一个名字，比如叫做mn</li>
<li>-p ：将宿主机端口与容器端口映射，冒号左侧是宿主机端口，右侧是容器端口</li>
<li>-d：后台运行容器</li>
<li>nginx：镜像名称，例如nginx</li>
</ul>
<p>这里的<code>-p</code>参数，是将容器端口映射到宿主机端口。</p>
<p>默认情况下，容器是隔离环境，我们直接访问宿主机的80端口，肯定访问不到容器中的nginx。</p>
<p>现在，将容器的80与宿主机的80关联起来，当我们访问宿主机的80端口时，就会被映射到容器的80，这样就能访问到nginx了：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647914074691-6feaec22-c168-454f-bbc0-f991238fde8a.png" alt="img"></p>
<h3 id="案例2-进入容器，修改文件"><a href="#案例2-进入容器，修改文件" class="headerlink" title="案例2-进入容器，修改文件"></a>案例2-进入容器，修改文件</h3><p><strong>需求</strong>：进入Nginx容器，修改HTML文件内容，添加“传智教育欢迎您”</p>
<p><strong>提示</strong>：进入容器要用到docker exec命令。</p>
<p><strong>步骤</strong>：</p>
<p>1）进入容器。进入我们刚刚创建的nginx容器的命令为：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it ng bash</span><br></pre></td></tr></table></figure>



<p>命令解读：</p>
<ul>
<li> docker exec ：进入容器内部，执行一个命令 </li>
<li> -it : 给当前进入的容器创建一个标准输入、输出终端，允许我们与容器交互 </li>
<li> ng ：要进入的容器的名称 (自己命名的)</li>
<li> bash：进入容器后执行的命令，bash是一个linux终端交互命令 </li>
</ul>
<p>2）进入nginx的HTML所在目录 /usr/share/nginx/html</p>
<p>容器内部会模拟一个独立的Linux文件系统，看起来如同一个linux服务器一样：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647915695755-1dbe5d65-be00-4ca8-b019-c8c3b1419604.png" alt="img"></p>
<p>nginx的环境、配置、运行文件全部都在这个文件系统中，包括我们要修改的html文件。</p>
<p>查看DockerHub网站中的nginx页面，可以知道nginx的html目录位置在<code>/usr/share/nginx/html</code></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647916343750-ee80136a-0e59-4a53-8fcf-d7a422a33798.png" alt="img"></p>
<p>我们执行命令，进入该目录：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/share/nginx/html</span><br></pre></td></tr></table></figure>



<p>查看目录下文件：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647915897023-2efbaa77-e4a2-49ab-a357-ad2e7592e996.png" alt="img"></p>
<p>3）修改index.html的内容</p>
<p>容器内没有vi命令，无法直接修改，我们用下面的命令来修改：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i &#x27;s#Welcome to nginx#传智教育欢迎您#g&#x27; index.html</span><br><span class="line">sed -i &#x27;s#&lt;head&gt;#&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;#g&#x27; index.html</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647916803745-96a59a45-fa28-4006-90dc-b83273684956.png" alt="img"></p>
<p>在浏览器访问自己的虚拟机地址，例如我的是：<a href="http://192.168.150.129，即可看到结果：">http://192.168.150.129，即可看到结果：</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647916834800-8997b623-fe28-4650-95e7-9c82614664d6.png" alt="img"></p>
<h3 id="练习一："><a href="#练习一：" class="headerlink" title="练习一："></a>练习一：</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647917897353-3264a6e2-ab48-41dc-bf79-d3d852c94cc9.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647917758147-482376fe-ccec-4c49-8b38-e14e0e780077.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647917721053-ae47ac02-091f-4a2b-bbcf-fa3bd6848316.png" alt="img"></p>
<h3 id="练习二："><a href="#练习二：" class="headerlink" title="练习二："></a>练习二：</h3><p>进入redis容器，并执行redis-cli客户端命令，存入num=666</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647918297239-0049bbcc-f30e-4512-9dcb-e129be2435bb.png" alt="img"></p>
<h1 id="三、Docker容器的数据"><a href="#三、Docker容器的数据" class="headerlink" title="三、Docker容器的数据"></a>三、Docker容器的数据</h1><h2 id="一、数据卷概念及作用"><a href="#一、数据卷概念及作用" class="headerlink" title="一、数据卷概念及作用"></a>一、数据卷概念及作用</h2><p><strong>数据卷（volume）</strong>是一个虚拟目录，指向宿主机文件系统中的某个目录。</p>
<p> <img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647918571513-a818bd32-448d-468b-a805-7acaeb47578e.png" alt="img"></p>
<p> 一旦完成数据卷挂载，对容器的一切操作都会作用在数据卷对应的宿主机目录了。</p>
<p>这样，我们操作宿主机的/var/lib/docker/volumes/html目录，就等于操作容器内的/usr/share/nginx/html目录了</p>
<p><strong>数据卷作用</strong> </p>
<p>• 容器数据持久化 </p>
<p>• 外部机器和容器间接通信 </p>
<p>• 容器之间数据交换  </p>
<h2 id="二、数据卷操作命令"><a href="#二、数据卷操作命令" class="headerlink" title="二、数据卷操作命令"></a>二、数据卷操作命令</h2><h3 id="1-数据卷基本语法"><a href="#1-数据卷基本语法" class="headerlink" title="1.数据卷基本语法"></a>1.数据卷基本语法</h3><p>数据卷操作的基本语法如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume [COMMAND]</span><br></pre></td></tr></table></figure>



<p>docker volume命令是数据卷操作，根据命令后跟随的command来确定下一步的操作：</p>
<p>create  创建一个volume</p>
<p>inspect  显示一个或多个volume的信息</p>
<p>ls  列出所有的volume</p>
<p> prune  删除未使用的volume</p>
<p> rm  删除一个或多个指定的volume</p>
<h3 id="2-创建和查看数据卷"><a href="#2-创建和查看数据卷" class="headerlink" title="2.创建和查看数据卷"></a>2.创建和查看数据卷</h3><p><strong>需求</strong>：创建一个数据卷，并查看数据卷在宿主机的目录位置</p>
<p>① 创建数据卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume create html</span><br></pre></td></tr></table></figure>



<p>② 查看所有数据</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume ls</span><br></pre></td></tr></table></figure>



<p>结果：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647919365788-59a1f7a9-2f5c-4e45-972a-d7804f5a78bc.png" alt="img"></p>
<p>③ 查看数据卷详细信息卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume inspect html</span><br></pre></td></tr></table></figure>



<p>结果：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647919314999-e0990b84-dd54-411f-a03b-a63fb902946d.png" alt="img"></p>
<p>可以看到，我们创建的html这个数据卷关联的宿主机目录为<code>/var/lib/docker/volumes/html/_data</code>目录。</p>
<h3 id="3-挂载数据卷"><a href="#3-挂载数据卷" class="headerlink" title="3.挂载数据卷"></a>3.挂载数据卷</h3><p>我们在创建容器时，可以通过 -v 参数来挂载一个数据卷到某个容器内目录，命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  --name mn \</span><br><span class="line">  -v html:/root/html \</span><br><span class="line">  -p 8080:80</span><br><span class="line">  nginx \</span><br></pre></td></tr></table></figure>



<p>这里的-v就是挂载数据卷的命令：</p>
<ul>
<li><code>-v html:/root/htm</code> ：把html数据卷挂载到容器内的/root/html这个目录中</li>
</ul>
<p>小结：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647932493924-1730bc87-e6a0-4086-9cd8-bc0577210311.png" alt="img"></p>
<h3 id="案例-给nginx挂载数据卷"><a href="#案例-给nginx挂载数据卷" class="headerlink" title="案例-给nginx挂载数据卷"></a>案例-给nginx挂载数据卷</h3><p><strong>需求</strong>：创建一个nginx容器，修改容器内的html目录内的index.html内容</p>
<p><strong>分析</strong>：上个案例中，我们进入nginx容器内部，已经知道nginx的html目录所在位置/usr/share/nginx/html ，我们需要把这个目录挂载到html这个数据卷上，方便操作其中的内容。</p>
<p><strong>提示</strong>：运行容器时使用 -v 参数挂载数据卷</p>
<p>步骤：</p>
<p>① 创建容器并挂载数据卷到容器内的HTML目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name ng -v html:/usr/share/nginx/html -p 80:80 -d nginx</span><br></pre></td></tr></table></figure>



<p>② 进入html数据卷所在位置，并修改HTML内容</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看html数据卷的位置</span></span><br><span class="line">docker volume inspect html</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入该目录</span></span><br><span class="line">cd /var/lib/docker/volumes/html/_data</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改文件</span></span><br><span class="line">vi index.html</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647933318432-964c6ac0-fafe-452d-a3ea-0ebd750ba497.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647933418631-7485e2dd-961d-4757-b7f2-8340f366abfd.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647933395000-8de24bb4-3cd0-4742-8d23-2ba8c6c191e3.png" alt="img"></p>
<p>访问<a target="_blank" rel="noopener" href="http://192.168.150.129/">http://192.168.150.129/</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647931850788-33dff642-da56-4878-abaf-da68b35b874c.png" alt="img"></p>
<h3 id="案例-给MySQL挂载本地目录"><a href="#案例-给MySQL挂载本地目录" class="headerlink" title="案例-给MySQL挂载本地目录"></a>案例-给MySQL挂载本地目录</h3><p>容器不仅仅可以挂载数据卷，也可以直接挂载到宿主机目录上。关联关系如下：</p>
<ul>
<li>带数据卷模式：宿主机目录 –&gt; 数据卷 —&gt; 容器内目录</li>
<li>直接挂载模式：宿主机目录 —&gt; 容器内目录</li>
</ul>
<p>如图：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647919722062-3a79902c-79d1-4a2c-94fd-8546d9a57f75.png" alt="img"></p>
<p><strong>语法</strong>：</p>
<p>目录挂载与数据卷挂载的语法是类似的：</p>
<ul>
<li>-v [宿主机目录]:[容器内目录]</li>
<li>-v [宿主机文件]:[容器内文件]</li>
</ul>
<p><strong>需求</strong>：创建并运行一个MySQL容器，将宿主机目录直接挂载到容器</p>
<p>实现思路如下：</p>
<p>1）在将课前资料中的mysql.tar文件上传到虚拟机，通过load命令加载为镜像</p>
<p>2）创建目录/tmp/mysql/data</p>
<p>3）创建目录/tmp/mysql/conf，将课前资料提供的hmy.cnf文件上传到/tmp/mysql/conf</p>
<p>4）去DockerHub查阅资料，创建并运行MySQL容器，要求：</p>
<p>① 挂载/tmp/mysql/data到mysql容器内数据存储目录</p>
<p>② 挂载/tmp/mysql/conf/hmy.cnf到mysql容器的配置文件</p>
<p>③ 设置MySQL密码</p>
<p>1）在将课前资料中的<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/13XwuHsoOKN6DMylmx8yq8Q?pwd=xkk6">mysql.tar</a>（提取码xkk6）文件上传到虚拟机，通过load命令加载为镜像</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647949901355-de7c4cfa-ae08-449b-bdf4-afc3c2903814.png" alt="img"></p>
<p>2）创建目录/tmp/mysql/data</p>
<p>3）创建目录/tmp/mysql/conf，将课前资料提供的hmy.cnf文件上传到/tmp/mysql/conf</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647949824622-d2b551ef-3a95-4291-a550-bdd4cf474c7b.png" alt="img"></p>
<p>4）去DockerHub查阅资料，创建并运行MySQL容器，要求：</p>
<p>① 挂载/tmp/mysql/data到mysql容器内数据存储目录</p>
<p>② 挂载/tmp/mysql/conf/hmy.cnf到mysql容器的配置文件</p>
<p>③ 设置MySQL密码</p>
<p>docker run \</p>
<p>​    –name mysql \</p>
<p>​    -e MYSQL_ROOT_PASSWORD=123 \</p>
<p>​    -p 3306:3306 \</p>
<p>​    -v  /tmp/mysql/conf /hmy.cnf:/etc/mysql/my.cnf and /etc/mysql/conf.d/hmy.cnf \</p>
<p>​    -v  /tmp/mysql/data:/var/lib/mysql \</p>
<p>​    -d mysql:5.7.25</p>
<p>小结：</p>
<p>docker run的命令中通过 -v 参数挂载文件或目录到容器中：</p>
<ul>
<li>-v volume名称:容器内目录</li>
<li>-v 宿主机文件:容器内文</li>
<li>-v 宿主机目录:容器内目录</li>
</ul>
<p>数据卷挂载与目录直接挂载的</p>
<ul>
<li>数据卷挂载耦合度低，由docker来管理目录，但是目录较深，不好找</li>
<li>目录挂载耦合度高，需要我们自己管理目录，不过目录容易寻找查看</li>
</ul>
<h1 id="四、Dockerfile自定义镜像"><a href="#四、Dockerfile自定义镜像" class="headerlink" title="四、Dockerfile自定义镜像"></a>四、Dockerfile自定义镜像</h1><p> 常见的镜像在DockerHub就能找到，但是我们自己写的项目就必须自己构建镜像了。</p>
<p>而要自定义镜像，就必须先了解镜像的结构才行。</p>
<h2 id="1-镜像结构"><a href="#1-镜像结构" class="headerlink" title="1.镜像结构"></a>1.镜像结构</h2><p>镜像是将应用程序及其需要的系统函数库、环境、配置、依赖打包而成。</p>
<p>我们以MySQL为例，来看看镜像的组成结构：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1647932714441-0d3231ec-b866-4f9e-86f2-cdb8de21bf30.png" alt="img"></p>
<p>简单来说，镜像就是在系统函数库、运行环境基础上，添加应用程序文件、配置文件、依赖文件等组合，然后编写好启动脚本打包在一起形成的文件。</p>
<p>我们要构建镜像，其实就是实现上述打包的过程。</p>
<h2 id="2-Dockerfile语法"><a href="#2-Dockerfile语法" class="headerlink" title="2.Dockerfile语法"></a>2.Dockerfile语法</h2><p>构建自定义的镜像时，并不需要一个个文件去拷贝，打包。</p>
<p>我们只需要告诉Docker，我们的镜像的组成，需要哪些BaseImage、需要拷贝什么文件、需要安装什么依赖、启动脚本是什么，将来Docker会帮助我们构建镜像。</p>
<p>而描述上述信息的文件就是Dockerfile文件。</p>
<p><strong>Dockerfile</strong>就是一个文本文件，其中包含一个个的**指令(Instruction)**，用指令来说明要执行什么操作来构建镜像。每一个指令都会形成一层Layer。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118761850-55b107ef-3554-4e87-aa75-52512ed6f8c7.png" alt="img"></p>
<p>更新详细语法说明，请参考官网文档： <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder">https://docs.docker.com/engine/reference/builder</a></p>
<h2 id="3-构建Java项目"><a href="#3-构建Java项目" class="headerlink" title="3.构建Java项目"></a>3.构建Java项目</h2><h3 id="（1）基于Ubuntu构建Java项目"><a href="#（1）基于Ubuntu构建Java项目" class="headerlink" title="（1）基于Ubuntu构建Java项目"></a>（1）基于Ubuntu构建Java项目</h3><p>需求：基于Ubuntu镜像构建一个新镜像，运行一个java项目</p>
<ul>
<li> 步骤1：新建一个空文件夹docker-demo</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118791070-d7706a51-f2a6-4512-bcc8-885a7739231f.png" alt="img"></p>
<ul>
<li>步骤2：拷贝课前资料中的docker-demo.jar文件到docker-demo这个目录<br><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118805564-e8eaa28d-a617-4f74-8617-8405ba731b16.png" alt="img"></li>
<li>步骤3：拷贝课前资料中的jdk8.tar.gz文件到docker-demo这个目录<br><img src="D:\blog\Hexo\source_posts\assets\image-20210801101410200.png" alt="img"><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118840554-e9dd01c8-3ea8-4fcc-881a-45a75ed19942.png" alt="img"></li>
<li>步骤4：拷贝课前资料提供的Dockerfile到docker-demo这个目录<br><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118858886-623e791b-1094-48c5-bd12-699b583e413b.png" alt="img">其中的内容如下： </li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 指定基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">16.04</span></span><br><span class="line"><span class="comment"># 配置环境变量，JDK的安装目录</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_DIR=/usr/local</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝jdk和java项目的包</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./jdk8.tar.gz <span class="variable">$JAVA_DIR</span>/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./docker-demo.jar /tmp/app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装JDK</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$JAVA_DIR</span> \</span></span><br><span class="line"><span class="bash"> &amp;&amp; tar -xf ./jdk8.tar.gz \</span></span><br><span class="line"><span class="bash"> &amp;&amp; mv ./jdk1.8.0_144 ./java8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME=$JAVA_DIR/java8</span><br><span class="line"><span class="keyword">ENV</span> PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8090</span></span><br><span class="line"><span class="comment"># 入口，java项目的启动命令</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> java -jar /tmp/app.jar</span></span><br></pre></td></tr></table></figure>

<ul>
<li>步骤5：进入docker-demo<br>将准备好的docker-demo上传到虚拟机任意目录，然后进入docker-demo目录下 </li>
<li> 步骤6：运行命令： </li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker build -t javaweb:1.0 .</span><br></pre></td></tr></table></figure>

<p>最后访问 <a target="_blank" rel="noopener" href="http://192.168.150.101:8090/hello/count%EF%BC%8C%E5%85%B6%E4%B8%AD%E7%9A%84ip%E6%94%B9%E6%88%90%E4%BD%A0%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BAip">http://192.168.150.101:8090/hello/count，其中的ip改成你的虚拟机ip</a></p>
<h3 id="（2）基于java8构建Java项目"><a href="#（2）基于java8构建Java项目" class="headerlink" title="（2）基于java8构建Java项目"></a>（2）基于java8构建Java项目</h3><p>虽然我们可以基于Ubuntu基础镜像，添加任意自己需要的安装包，构建镜像，但是却比较麻烦。所以大多数情况下，我们都可以在一些安装了部分软件的基础镜像上做改造。</p>
<p>例如，构建java项目的镜像，可以在已经准备了JDK的基础镜像基础上构建。</p>
<p>需求：基于java:8-alpine镜像，将一个Java项目构建为镜像</p>
<p>实现思路如下：</p>
<ul>
<li><p> ① 新建一个空的目录，然后在目录中新建一个文件，命名为Dockerfile </p>
</li>
<li><p> ② 拷贝课前资料提供的docker-demo.jar到这个目录中 </p>
</li>
<li><p> ③ 编写Dockerfile文件： </p>
</li>
<li><ul>
<li> a ）基于java:8-alpine作为基础镜像 </li>
<li> b ）将app.jar拷贝到镜像中 </li>
<li> c ）暴露端口 </li>
<li>d ）编写入口ENTRYPOINT<br>内容如下： </li>
</ul>
</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span>-alpine</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./app.jar /tmp/app.jar</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8090</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> java -jar /tmp/app.jar</span></span><br></pre></td></tr></table></figure>

<ul>
<li> ④ 使用docker build命令构建镜像 </li>
<li> ⑤ 使用docker run创建容器并运行 </li>
</ul>
<p>小结：</p>
<ol>
<li> Dockerfile的本质是一个文件，通过指令描述镜像的构建过程 </li>
<li> Dockerfile的第一行必须是FROM，从一个基础镜像来构建 </li>
<li> 基础镜像可以是基本操作系统，如Ubuntu。也可以是其他人制作好的镜像，例如：java:8-alpine </li>
</ol>
<h1 id="五、Docker-Compose"><a href="#五、Docker-Compose" class="headerlink" title="五、Docker-Compose"></a>五、Docker-Compose</h1><p>Docker Compose可以基于Compose文件帮我们快速的部署分布式应用，而无需手动一个个创建和运行容器！</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118879185-34b7b573-f676-4f18-936e-dced161b2f6c.png" alt="img"></p>
<h2 id="1-初识DockerCompose"><a href="#1-初识DockerCompose" class="headerlink" title="1.初识DockerCompose"></a>1.初识DockerCompose</h2><p>Compose文件是一个文本文件，通过指令定义集群中的每个容器如何运行。格式如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">version: <span class="string">&quot;3.8&quot;</span></span><br><span class="line"> services:</span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:<span class="number">5.7</span><span class="number">.25</span></span><br><span class="line">    environment:</span><br><span class="line">     MYSQL_ROOT_PASSWORD: <span class="number">123</span> </span><br><span class="line">    volumes:</span><br><span class="line">     - <span class="string">&quot;/tmp/mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">     - <span class="string">&quot;/tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf&quot;</span></span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">     - <span class="string">&quot;8090:8090&quot;</span></span><br></pre></td></tr></table></figure>



<p>上面的Compose文件就描述一个项目，其中包含两个容器：</p>
<ul>
<li>mysql：一个基于<code>mysql:5.7.25</code>镜像构建的容器，并且挂载了两个目录</li>
<li>web：一个基于<code>docker build</code>临时构建的镜像容器，映射端口时8090</li>
</ul>
<p>DockerCompose的详细语法参考官网：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></p>
<p>其实DockerCompose文件可以看做是将多个docker run命令写到一个文件，只是语法稍有差异。</p>
<h2 id="2-安装DockerCompose"><a href="#2-安装DockerCompose" class="headerlink" title="2.安装DockerCompose"></a>2.安装DockerCompose</h2><h3 id="（1）下载"><a href="#（1）下载" class="headerlink" title="（1）下载"></a>（1）下载</h3><p>Linux下需要通过命令下载：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/1.23.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>



<p>如果下载速度较慢，或者下载失败，可以使用课前资料提供的docker-compose文件：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648119168918-b7d77bf4-9a6f-4b34-bb9d-3ef4d702f444.png" alt="img"></p>
<p>上传到<code>/usr/local/bin/</code>目录也可以。</p>
<h3 id="（2）修改文件权限"><a href="#（2）修改文件权限" class="headerlink" title="（2）修改文件权限"></a>（2）修改文件权限</h3><p>修改文件权限：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 修改权限</span></span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h3 id="（3）Base自动补全命令："><a href="#（3）Base自动补全命令：" class="headerlink" title="（3）Base自动补全命令："></a>（3）Base自动补全命令：</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 补全命令</span></span><br><span class="line">curl -L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose</span><br></pre></td></tr></table></figure>



<p>如果这里出现错误，需要修改自己的hosts文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;199.232.68.133 raw.githubusercontent.com&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>



<h2 id="3-部署微服务集群"><a href="#3-部署微服务集群" class="headerlink" title="3.部署微服务集群"></a>3.部署微服务集群</h2><p><strong>需求</strong>：将之前学习的cloud-demo微服务集群利用DockerCompose部署</p>
<p><strong>实现思路</strong>：</p>
<p>① 查看课前资料提供的cloud-demo文件夹，里面已经编写好了docker-compose文件</p>
<p>② 修改自己的cloud-demo项目，将数据库、nacos地址都命名为docker-compose中的服务名</p>
<p>③ 使用maven打包工具，将项目中的每个微服务都打包为app.jar</p>
<p>④ 将打包好的app.jar拷贝到cloud-demo中的每一个对应的子目录中</p>
<p>⑤ 将cloud-demo上传至虚拟机，利用 docker-compose up -d 来部署</p>
<h3 id="（1）compose文件"><a href="#（1）compose文件" class="headerlink" title="（1）compose文件"></a>（1）compose文件</h3><p>查看课前资料提供的cloud-demo文件夹，里面已经编写好了docker-compose文件，而且每个微服务都准备了一个独立的目录：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118907422-8426d925-44e9-4131-ba50-d070f112c200.png" alt="img"></p>
<p>内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nacos/nacos-server</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MODE:</span> <span class="string">standalone</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8848:8848&quot;</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7.25</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;$PWD/mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;$PWD/mysql/conf:/etc/mysql/conf.d/&quot;</span></span><br><span class="line">  <span class="attr">userservice:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./user-service</span></span><br><span class="line">  <span class="attr">orderservice:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./order-service</span></span><br><span class="line">  <span class="attr">gateway:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./gateway</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;10010:10010&quot;</span></span><br></pre></td></tr></table></figure>



<p>可以看到，其中包含5个service服务：</p>
<ul>
<li><p><code>nacos</code>：作为注册中心和配置中心 </p>
</li>
<li><ul>
<li><code>image: nacos/nacos-server</code>： 基于nacos/nacos-server镜像构建</li>
<li><code>environment</code>：环境变量 </li>
</ul>
</li>
<li><ul>
<li><ul>
<li><code>MODE: standalone</code>：单点模式启动</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><code>ports</code>：端口映射，这里暴露了8848端口</li>
</ul>
</li>
<li><p><code>mysql</code>：数据库 </p>
</li>
<li><ul>
<li><code>image: mysql:5.7.25</code>：镜像版本是mysql:5.7.25</li>
<li><code>environment</code>：环境变量 </li>
</ul>
</li>
<li><ul>
<li><ul>
<li><code>MYSQL_ROOT_PASSWORD: 123</code>：设置数据库root账户的密码为123</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><code>volumes</code>：数据卷挂载，这里挂载了mysql的data、conf目录，其中有我提前准备好的数据</li>
</ul>
</li>
<li><p><code>userservice</code>、<code>orderservice</code>、<code>gateway</code>：都是基于Dockerfile临时构建的</p>
</li>
</ul>
<p>查看mysql目录，可以看到其中已经准备好了cloud_order、cloud_user表：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118920588-5fd651d0-abad-46ce-91ec-a76cdacd9877.png" alt="img"></p>
<p>查看微服务目录，可以看到都包含Dockerfile文件：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118925899-a053c9e1-1cfb-43ca-8562-742b9235f147.png" alt="img"></p>
<p>内容如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span>-alpine</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./app.jar /tmp/app.jar</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> java -jar /tmp/app.jar</span></span><br></pre></td></tr></table></figure>



<h3 id="（2）修改微服务配置"><a href="#（2）修改微服务配置" class="headerlink" title="（2）修改微服务配置"></a>（2）修改微服务配置</h3><p>因为微服务将来要部署为docker容器，而容器之间互联不是通过IP地址，而是通过容器名。这里我们将order-service、user-service、gateway服务的mysql、nacos地址都修改为基于容器名的访问。</p>
<p>如下所示：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://mysql:3306/cloud_order?useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">orderservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">nacos:8848</span> <span class="comment"># nacos服务地址</span></span><br></pre></td></tr></table></figure>



<h3 id="（3）打包"><a href="#（3）打包" class="headerlink" title="（3）打包"></a>（3）打包</h3><p>接下来需要将我们的每个微服务都打包。因为之前查看到Dockerfile中的jar包名称都是app.jar，因此我们的每个微服务都需要用这个名称。</p>
<p>可以通过修改pom.xml中的打包名称来实现，每个微服务都需要修改：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 服务打包的最终名称 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>app<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>打包后：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118940021-9ed645b0-b495-4e6e-886f-27399640231e.png" alt="img"></p>
<h3 id="（4）拷贝jar包到部署目录"><a href="#（4）拷贝jar包到部署目录" class="headerlink" title="（4）拷贝jar包到部署目录"></a>（4）拷贝jar包到部署目录</h3><p>编译打包好的app.jar文件，需要放到Dockerfile的同级目录中。注意：每个微服务的app.jar放到与服务名称对应的目录，别搞错了。</p>
<p>user-service：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118949777-b9c48c30-a463-4c95-8198-87c63ca29615.png" alt="img"></p>
<p>order-service：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118977341-8d119a9e-9e70-402c-aaa7-4a51a3c7aac8.png" alt="img"></p>
<p>gateway：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648118989467-2897beb3-0ecf-43a6-9fd1-0e0b67a1ff5f.png" alt="img"></p>
<h3 id="（5）部署"><a href="#（5）部署" class="headerlink" title="（5）部署"></a>（5）部署</h3><p>最后，我们需要将文件整个cloud-demo文件夹上传到虚拟机中，理由DockerCompose部署。</p>
<p>上传到任意目录：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22712195/1648119000632-477f3a92-bb19-4f35-8dd0-8f0f3acb0879.png" alt="img"></p>
<p>部署：</p>
<p>进入cloud-demo目录，然后运行下面的命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>



<h1 id="六、Docker镜像仓库"><a href="#六、Docker镜像仓库" class="headerlink" title="六、Docker镜像仓库"></a>六、Docker镜像仓库</h1><h2 id="1-搭建私有镜像仓库"><a href="#1-搭建私有镜像仓库" class="headerlink" title="1.搭建私有镜像仓库"></a>1.搭建私有镜像仓库</h2><h3 id="Docker镜像仓库安装"><a href="#Docker镜像仓库安装" class="headerlink" title="Docker镜像仓库安装"></a>Docker镜像仓库安装</h3><p>搭建镜像仓库可以基于Docker官方提供的DockerRegistry来实现。</p>
<p>官网地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/_/registry">https://hub.docker.com/_/registry</a></p>
<h4 id="（1）简化版镜像仓库"><a href="#（1）简化版镜像仓库" class="headerlink" title="（1）简化版镜像仓库"></a>（1）简化版镜像仓库</h4><p>Docker官方的Docker Registry是一个基础版本的Docker镜像仓库，具备仓库管理的完整功能，但是没有图形化界面。</p>
<p>搭建方式比较简单，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --restart=always \</span><br><span class="line">    --name registry	\</span><br><span class="line">    -p 5000:5000 \</span><br><span class="line">    -v registry-data:/var/lib/registry \</span><br><span class="line">    registry</span><br></pre></td></tr></table></figure>



<p>命令中挂载了一个数据卷registry-data到容器内的/var/lib/registry 目录，这是私有镜像库存放数据的目录。</p>
<p>访问<a target="_blank" rel="noopener" href="http://yourip:5000/v2/_catalog">http://YourIp:5000/v2/_catalog</a> 可以查看当前私有镜像服务中包含的镜像</p>
<h4 id="（2）带有图形化界面版本"><a href="#（2）带有图形化界面版本" class="headerlink" title="（2）带有图形化界面版本"></a>（2）带有图形化界面版本</h4><p>使用DockerCompose部署带有图象界面的DockerRegistry，命令如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.0&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./registry-data:/var/lib/registry</span></span><br><span class="line">  <span class="attr">ui:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">joxit/docker-registry-ui:static</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REGISTRY_TITLE=传智教育私有仓库</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REGISTRY_URL=http://registry:5000</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">registry</span></span><br></pre></td></tr></table></figure>



<h4 id="（3）配置Docker信任地址"><a href="#（3）配置Docker信任地址" class="headerlink" title="（3）配置Docker信任地址"></a>（3）配置Docker信任地址</h4><p>我们的私服采用的是http协议，默认不被Docker信任，所以需要做一个配置：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 打开要修改的文件</span></span><br><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加内容：</span></span><br><span class="line">&quot;insecure-registries&quot;:[&quot;http://192.168.150.101:8080&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重加载</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启docker</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>



<h2 id="2-推送、拉取镜像"><a href="#2-推送、拉取镜像" class="headerlink" title="2.推送、拉取镜像"></a>2.推送、拉取镜像</h2><p>推送镜像到私有镜像服务必须先tag，步骤如下：</p>
<p>① 重新tag本地镜像，名称前缀为私有仓库的地址：192.168.150.101:8080/</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker tag nginx:latest 192.168.150.101:8080/nginx:1.0</span><br></pre></td></tr></table></figure>



<p>② 推送镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker push 192.168.150.101:8080/nginx:1.0</span><br></pre></td></tr></table></figure>



<p>③ 拉取镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull 192.168.150.101:8080/nginx:1.0</span><br></pre></td></tr></table></figure>





</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">小羊肖恩</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/04/07/docker/">http://example.com/2022/04/07/docker/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Xyのblog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/docker/">docker</a></div><div class="post_share"><div class="social-share" data-image="https://img0.baidu.com/it/u=3264599554,560842961&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=302" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2021/12/28/%E9%9B%86%E5%90%88/"><img class="next-cover" src="https://img0.baidu.com/it/u=3264599554,560842961&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=302" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">框架</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">小羊肖恩</div><div class="author-info__description">一分耕耘，一分收获</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xiaobin133" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2310493201@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/xiaobin133.github.io" target="_blank" title="Email"><i class="fa-solid fa-teddy-bear"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81docker%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">一、docker安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81docker%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">二、docker命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%BF%9B%E7%A8%8B%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">1. 进程相关命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%95%9C%E5%83%8F%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">2. 镜像相关命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%B9%E5%99%A8%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">3.  容器相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B1-%E5%88%9B%E5%BB%BA%E5%B9%B6%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8"><span class="toc-number">2.3.1.</span> <span class="toc-text">案例1-创建并运行一个容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B2-%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8%EF%BC%8C%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.2.</span> <span class="toc-text">案例2-进入容器，修改文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%80%EF%BC%9A"><span class="toc-number">2.3.3.</span> <span class="toc-text">练习一：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%BA%8C%EF%BC%9A"><span class="toc-number">2.3.4.</span> <span class="toc-text">练习二：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">3.</span> <span class="toc-text">三、Docker容器的数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%A6%82%E5%BF%B5%E5%8F%8A%E4%BD%9C%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">一、数据卷概念及作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">二、数据卷操作命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">3.2.1.</span> <span class="toc-text">1.数据卷基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%92%8C%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.创建和查看数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.挂载数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-%E7%BB%99nginx%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">3.2.4.</span> <span class="toc-text">案例-给nginx挂载数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-%E7%BB%99MySQL%E6%8C%82%E8%BD%BD%E6%9C%AC%E5%9C%B0%E7%9B%AE%E5%BD%95"><span class="toc-number">3.2.5.</span> <span class="toc-text">案例-给MySQL挂载本地目录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Dockerfile%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F"><span class="toc-number">4.</span> <span class="toc-text">四、Dockerfile自定义镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%95%9C%E5%83%8F%E7%BB%93%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">1.镜像结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Dockerfile%E8%AF%AD%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">2.Dockerfile语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%9E%84%E5%BB%BAJava%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.3.</span> <span class="toc-text">3.构建Java项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%9F%BA%E4%BA%8EUbuntu%E6%9E%84%E5%BB%BAJava%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.3.1.</span> <span class="toc-text">（1）基于Ubuntu构建Java项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%9F%BA%E4%BA%8Ejava8%E6%9E%84%E5%BB%BAJava%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.3.2.</span> <span class="toc-text">（2）基于java8构建Java项目</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81Docker-Compose"><span class="toc-number">5.</span> <span class="toc-text">五、Docker-Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%9D%E8%AF%86DockerCompose"><span class="toc-number">5.1.</span> <span class="toc-text">1.初识DockerCompose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85DockerCompose"><span class="toc-number">5.2.</span> <span class="toc-text">2.安装DockerCompose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E4%B8%8B%E8%BD%BD"><span class="toc-number">5.2.1.</span> <span class="toc-text">（1）下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90"><span class="toc-number">5.2.2.</span> <span class="toc-text">（2）修改文件权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89Base%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">5.2.3.</span> <span class="toc-text">（3）Base自动补全命令：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%83%A8%E7%BD%B2%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4"><span class="toc-number">5.3.</span> <span class="toc-text">3.部署微服务集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89compose%E6%96%87%E4%BB%B6"><span class="toc-number">5.3.1.</span> <span class="toc-text">（1）compose文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E4%BF%AE%E6%94%B9%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE"><span class="toc-number">5.3.2.</span> <span class="toc-text">（2）修改微服务配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E6%89%93%E5%8C%85"><span class="toc-number">5.3.3.</span> <span class="toc-text">（3）打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E6%8B%B7%E8%B4%9Djar%E5%8C%85%E5%88%B0%E9%83%A8%E7%BD%B2%E7%9B%AE%E5%BD%95"><span class="toc-number">5.3.4.</span> <span class="toc-text">（4）拷贝jar包到部署目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%885%EF%BC%89%E9%83%A8%E7%BD%B2"><span class="toc-number">5.3.5.</span> <span class="toc-text">（5）部署</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81Docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="toc-number">6.</span> <span class="toc-text">六、Docker镜像仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="toc-number">6.1.</span> <span class="toc-text">1.搭建私有镜像仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E5%AE%89%E8%A3%85"><span class="toc-number">6.1.1.</span> <span class="toc-text">Docker镜像仓库安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E7%AE%80%E5%8C%96%E7%89%88%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="toc-number">6.1.1.1.</span> <span class="toc-text">（1）简化版镜像仓库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%B8%A6%E6%9C%89%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E7%89%88%E6%9C%AC"><span class="toc-number">6.1.1.2.</span> <span class="toc-text">（2）带有图形化界面版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E9%85%8D%E7%BD%AEDocker%E4%BF%A1%E4%BB%BB%E5%9C%B0%E5%9D%80"><span class="toc-number">6.1.1.3.</span> <span class="toc-text">（3）配置Docker信任地址</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%8E%A8%E9%80%81%E3%80%81%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">6.2.</span> <span class="toc-text">2.推送、拉取镜像</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/04/07/docker/" title="docker"><img src="https://img0.baidu.com/it/u=3264599554,560842961&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=302" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docker"/></a><div class="content"><a class="title" href="/2022/04/07/docker/" title="docker">docker</a><time datetime="2022-04-07T11:39:08.000Z" title="发表于 2022-04-07 19:39:08">2022-04-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/28/%E9%9B%86%E5%90%88/" title="框架"><img src="https://img0.baidu.com/it/u=3264599554,560842961&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=302" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="框架"/></a><div class="content"><a class="title" href="/2021/12/28/%E9%9B%86%E5%90%88/" title="框架">框架</a><time datetime="2021-12-28T07:46:03.000Z" title="发表于 2021-12-28 15:46:03">2021-12-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/28/qq/" title="qq"><img src="https://img0.baidu.com/it/u=3264599554,560842961&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=302" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="qq"/></a><div class="content"><a class="title" href="/2021/12/28/qq/" title="qq">qq</a><time datetime="2021-12-28T07:24:24.000Z" title="发表于 2021-12-28 15:24:24">2021-12-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/28/%E2%80%9Cgit%E2%80%9D/" title="git"><img src="https://img0.baidu.com/it/u=3264599554,560842961&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=302" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="git"/></a><div class="content"><a class="title" href="/2021/12/28/%E2%80%9Cgit%E2%80%9D/" title="git">git</a><time datetime="2021-12-28T06:28:25.000Z" title="发表于 2021-12-28 14:28:25">2021-12-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/15/hello-world/" title="Hello World"><img src="https://img0.baidu.com/it/u=3264599554,560842961&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=1024&amp;h=302" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2021/12/15/hello-world/" title="Hello World">Hello World</a><time datetime="2021-12-15T01:56:49.751Z" title="发表于 2021-12-15 09:56:49">2021-12-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By 小羊肖恩</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://xiaobin133.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="7309701295" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>